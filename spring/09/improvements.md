# DITのようなサイトに動きを

## 動きをつけよう
こちらは第4回に作ってもらったDITのようなサイトです。第4回終了時点でのサイトを[テンプレート](./improvements_template.zip "DITのようなサイト")として用意しました。しかし、[本家](http://dit-rohm.com "DIT")のような動きがありません。今日は、この動きのないサイトにJavaScriptで動きをつけ、本家に近付けましょう。なお、初めて触るjQueryでこれだけのものを勉強会の時間内で作るのは大変なので、行けるところまでいっていただければと思います。進むにつれ難しくなるように並べてあります。

## はじめに
必ずテンプレートのHTMLとCSSに目を通してください。**テンプレートの構造、及びスタイルを十分に理解していないと今回の課題を解くことは不可能**です。しかし、細かいことまで全てを理解する必要はありません。jQueryのセレクターの書き方で困ったときにHTMLを見ると突破口が見えてくると思います。  
また、[jQueryの説明のページ](./jquery.md "jQuery")はブラウザの別タブで開いておいて、いつでも見られるようにしておくのが良いでしょう。このページにあるコードを写すだけで課題が完成するようには今回はなっていません。いずれはご自身で考えてコードを書く必要性が出てくることを見越してこのような方針をとりました。ご了承ください。しかし、詰まってしまった場合はお近くのメンターに遠慮なくお声掛けください。

### ヘッダーのフェードアウト
本家のサイトは下にスクロールするとヘッダーの画像が薄くなっていきます。これをjQueryで実現します。ヘッダー部分はお使いのブラウザの高さとちょうどになるようにCSSで指定してあるので、ページのスクロール量を取得し、その値をブラウザの高さで割り、さらに1からそれを引いてヘッダー部分の透明度とします。  

* ページがスクロールされたときに実行されるコードは  
  `$(document).scroll(function() {...})`で指定します。
* ページのスクロール量は`$(document).scrollTop()`で取得できます。とりあえずこれを変数に入れましょう。(posとでも。わかれば変数名はなんでもいいんです)
* ブラウザの高さは`$(window).height()`で取得できます。これも変数に入れておきましょう。(windowHeightとでも)
* 用意した二つの値を前述の計算に用い、スクロール量に対するヘッダーの透明度を求めましょう。この結果も変数に。(alphaとでも)

作った透明度alphaをヘッダーのopacityというCSSプロパティーの値にします。CSSをjQueryでいじる例はjQueryの説明の方にあるのでそちらを参考にしてください。

### 自動スクロール
第4回の課題では一番上のリンクをクリックしたら同じページの別の場所に「パッ」と移るようになっていました。ここではそれをアニメーションで移動するようにしたいと思います。  

ページ内リンクは`<a href="#foo">foo</a>`のようにHTMLで記述され、同じページ内のidがfooのdivに「パッ」と飛ぶのですが、`href`の中の書き方がCSSでのidの指定の仕方と同じであること（つまり、#idとすること）を利用したいと思います。  

具体的には、
* ページ内移動のリンクの`<a>`タグのhref属性を取得します  
* そのidを持ったdivのページ上部からの座標を取得します。  
* 上で取得した分だけページをスクロールします。これも[jQueryの説明](./jquery.md "jQuery")にある例を組み合わせると実現できます。  
* 以上の動作を、スクロールをさせるリンクがクリックされた時に動作するようイベントを登録しておくと良いでしょう。イベントを受け取る要素を指定しやすいようにテンプレートの方で画面上部のリンクには全てscroll_buttonとclassが付してあります。  


* 要素の属性の取得は`$(id、あるいはclass).attr("属性名")`でできます。

ただし、落とし穴が一つありまして、jQueryを使わなかった時の、本来のリンクの動作を無効化してあげる必要があります。`click`関数の引数の関数に`e`を引数として加えると、イベントをオブジェクトとして渡すことができます。そのイベントの`.preventDefault()'`を呼び出すと、本来のリンクのはたらきを抑えることができます。つまり、以下のように書きます。  

```JavaScript
$("セレクター").click(function(e) {
  e.preventDefault();
  ...
});
```

### メンター画像の周期的な切り替え
本家のサイトには、メンターの写真が並んでいる部分があるのですが、画面の広さが足りずに全員を一度には表示できてません。そこで、画像の部分が左右にスライドすることで表示する部分が変わるようにしてあります。第4回の答えでは二段に画像を3枚ずつ並べてありましたが、それを横一列に変えてはみ出るようにテンプレートでは変えたので、その部分が周期的に左右にスライドするようにしましょう。  

テンプレートのCSSにも書いてあるように、6枚の画像が横幅の大きなdivに入っていて、そのdivが横幅のより小さなdivに入っています。つまり、右に大きなdivがはみ出ている状態です。さらに、小さなdivのスクロールバーが隠してあります。しかし、スクロールバーが隠されていてもスクリプトで自動スクロールをさせることは可能です。  

* 上記の「小さなdiv」は`.scroll_frame`です。画面全体をスクロールさせるのが  
  `$("body, html").animate(...)`なら、個別のdivは...  
* 内側の大きなdivはさらに二つのdivに半分に分けてあります。その右側のdivの左からの距離を取ってくるには、画面の横幅を取ってくると良いでしょう。何か手がかりになるかもしれません。
* 8秒周期で行ったり来たりさせるので、8秒ごとに処理が実行されるときに現在のスクロール量が0であるか否かを見て、それに応じてスクロール先の座標を指定するといいでしょう。0ならば右半分が表示されるように、0でないならば右半分が表示されているとみて左半分が表示されるように…
* 関数の周期的な実行は以下のように書くと良いでしょう。周期は8秒、つまり8000msがちょうどだと感じました。
```JavaScript
window.setInterval(function() {
  ...処理内容
}, 8000);
```
<a href="/dit-rohm/textbook/blob/master/spring/10/sublime.md">Sublime Textのカスタマイズ</a>
